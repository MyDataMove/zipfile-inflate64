when:
  event: pull_request
  branch: [main, releases/*]

clone:
  git:
    image: woodpeckerci/plugin-git
    settings:
      partial: false
      depth: 1
      lfs: false
      tags: true

steps:
  standardize:
    image: python:${TAG}-bullseye
    when:
      - matrix:
          TAG: 3.9
    commands:
      - python -m venv venv
      - python -m pip install --upgrade pip setuptools setuptools_scm[toml] tox importlib_metadata
      - python -m tox -e check
      - python -m tox -e type

  build:
    image: python:${TAG}-bullseye
    commands:
      - python -m venv venv
      - /bin/bash -c "source venv/bin/activate"
      - python -m pip install --upgrade pip setuptools setuptools_scm[toml] tox importlib_metadata
      - python -m tox -e test

matrix:
  TAG:
    - 3.7
    - 3.8
    - 3.9
    - 3.10
    - 3.11
